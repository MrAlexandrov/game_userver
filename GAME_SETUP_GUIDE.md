# ๐ฎ ะัะบะพะฒะพะดััะฒะพ ะฟะพ ะทะฐะฟััะบั ะธะณัั-ะฒะธะบัะพัะธะฝั

ะะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ ะฟะพ ะฝะฐัััะพะนะบะต ะธ ะทะฐะฟััะบั ะฟัะพะตะบัะฐ ะฒะธะบัะพัะธะฝั ั Telegram ะฑะพัะพะผ.

## ๐ ะกะพะดะตัะถะฐะฝะธะต

1. [ะะฑะทะพั ะฟัะพะตะบัะฐ](#ะพะฑะทะพั-ะฟัะพะตะบัะฐ)
2. [ะััะธัะตะบัััะฐ](#ะฐััะธัะตะบัััะฐ)
3. [ะขัะตะฑะพะฒะฐะฝะธั](#ััะตะฑะพะฒะฐะฝะธั)
4. [ะฃััะฐะฝะพะฒะบะฐ ะธ ะฝะฐัััะพะนะบะฐ](#ัััะฐะฝะพะฒะบะฐ-ะธ-ะฝะฐัััะพะนะบะฐ)
5. [ะะฐะฟััะบ ะฟัะพะตะบัะฐ](#ะทะฐะฟััะบ-ะฟัะพะตะบัะฐ)
6. [ะกะพะทะดะฐะฝะธะต ะบะพะฝัะตะฝัะฐ](#ัะพะทะดะฐะฝะธะต-ะบะพะฝัะตะฝัะฐ)
7. [ะัะฟะพะปัะทะพะฒะฐะฝะธะต Telegram ะฑะพัะฐ](#ะธัะฟะพะปัะทะพะฒะฐะฝะธะต-telegram-ะฑะพัะฐ)
8. [API Reference](#api-reference)
9. [Troubleshooting](#troubleshooting)

## ๐ฏ ะะฑะทะพั ะฟัะพะตะบัะฐ

ะญัะพ ะฟะพะปะฝะพััะฝะบัะธะพะฝะฐะปัะฝะฐั ัะธััะตะผะฐ ะดะปั ะฟัะพะฒะตะดะตะฝะธั ะฒะธะบัะพัะธะฝ ั ะฟะพะดะดะตัะถะบะพะน:

- **Backend ะฝะฐ C++ (userver)** - ะฒััะพะบะพะฟัะพะธะทะฒะพะดะธัะตะปัะฝัะน HTTP API ัะตัะฒะตั
- **PostgreSQL** - ััะฐะฝะตะฝะธะต ะฒะพะฟัะพัะพะฒ, ะพัะฒะตัะพะฒ ะธ ัะตะทัะปััะฐัะพะฒ ะธะณั
- **Telegram Bot ะฝะฐ Python** - ะธะฝัะตััะตะนั ะดะปั ะธะณัะพะบะพะฒ
- **Game Logic** - ัะธััะตะผะฐ ะฟะพะดััะตัะฐ ะพัะบะพะฒ, ัะฟัะฐะฒะปะตะฝะธะต ัะตััะธัะผะธ

### ะะพะทะผะพะถะฝะพััะธ

โ ะกะพะทะดะฐะฝะธะต ะฟะฐะบะพะฒ ะฒะพะฟัะพัะพะฒ  
โ ะฃะฟัะฐะฒะปะตะฝะธะต ะฒะพะฟัะพัะฐะผะธ ะธ ะฒะฐัะธะฐะฝัะฐะผะธ ะพัะฒะตัะพะฒ  
โ ะะณัะพะฒัะต ัะตััะธะธ ั ะฝะตัะบะพะปัะบะธะผะธ ะธะณัะพะบะฐะผะธ  
โ ะะพะดััะตั ะพัะบะพะฒ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ  
โ Telegram ะธะฝัะตััะตะนั ะดะปั ัะดะพะฑะฝะพะน ะธะณัั  
โ REST API ะดะปั ะธะฝัะตะณัะฐัะธะธ ั ะดััะณะธะผะธ ัะธััะตะผะฐะผะธ  

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ
โ  Telegram Bot   โ โ ะะณัะพะบะธ ะฒะทะฐะธะผะพะดะตะนััะฒััั ัะตัะตะท Telegram
โโโโโโโโโโฌโโโโโโโโโ
         โ HTTP API
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  userver (C++)  โ โ Backend ัะตัะฒะตั
โ   Game Logic    โ
โโโโโโโโโโฌโโโโโโโโโ
         โ SQL
         โผ
โโโโโโโโโโโโโโโโโโโ
โ   PostgreSQL    โ โ ะะฐะทะฐ ะดะฐะฝะฝัั
โโโโโโโโโโโโโโโโโโโ
```

### ะะพะผะฟะพะฝะตะฝัั

1. **Content Management API** - ัะพะทะดะฐะฝะธะต ะธ ัะฟัะฐะฒะปะตะฝะธะต ะบะพะฝัะตะฝัะพะผ
   - ะะฐะบะธ ะฒะพะฟัะพัะพะฒ
   - ะะพะฟัะพัั
   - ะะฐัะธะฐะฝัั ะพัะฒะตัะพะฒ

2. **Game API** - ะธะณัะพะฒะฐั ะผะตัะฐะฝะธะบะฐ
   - ะกะพะทะดะฐะฝะธะต ะธะณัะพะฒัั ัะตััะธะน
   - ะะพะฑะฐะฒะปะตะฝะธะต ะธะณัะพะบะพะฒ
   - ะฃะฟัะฐะฒะปะตะฝะธะต ัะพะดะพะผ ะธะณัั
   - ะะพะดััะตั ัะตะทัะปััะฐัะพะฒ

3. **Telegram Bot** - ะฟะพะปัะทะพะฒะฐัะตะปััะบะธะน ะธะฝัะตััะตะนั
   - ะัะฑะพั ะฟะฐะบะฐ ะฒะพะฟัะพัะพะฒ
   - ะัะฒะตัั ะฝะฐ ะฒะพะฟัะพัั
   - ะัะพัะผะพัั ัะตะทัะปััะฐัะพะฒ

## ๐ฆ ะขัะตะฑะพะฒะฐะฝะธั

### Backend (C++)

- CMake 3.12+
- C++23 compatible compiler (GCC 11+, Clang 14+)
- PostgreSQL 12+
- userver framework (ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะณััะถะฐะตััั)

### Telegram Bot (Python)

- Python 3.8+
- pip

### ะกะธััะตะผะฐ

- Linux (Ubuntu 22.04 ัะตะบะพะผะตะฝะดัะตััั)
- macOS (ั ะฝะตะบะพัะพััะผะธ ะพะณัะฐะฝะธัะตะฝะธัะผะธ)
- Docker (ะพะฟัะธะพะฝะฐะปัะฝะพ)

## ๐ ะฃััะฐะฝะพะฒะบะฐ ะธ ะฝะฐัััะพะนะบะฐ

### ะจะฐะณ 1: ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั

```bash
git clone <your-repo-url>
cd game_userver
```

### ะจะฐะณ 2: ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ะดะปั backend

#### Ubuntu/Debian

```bash
sudo apt-get update
sudo apt-get install -y \
    cmake \
    build-essential \
    postgresql \
    postgresql-contrib \
    libpq-dev \
    git
```

#### macOS

```bash
brew install cmake postgresql
```

### ะจะฐะณ 3: ะะฐัััะพะนะบะฐ PostgreSQL

```bash
# ะะฐะฟัััะธัะต PostgreSQL
sudo systemctl start postgresql  # Linux
brew services start postgresql   # macOS

# ะกะพะทะดะฐะนัะต ะฑะฐะทั ะดะฐะฝะฝัั ะธ ะฟะพะปัะทะพะฒะฐัะตะปั
sudo -u postgres psql
```

ะ psql ะฒัะฟะพะปะฝะธัะต:

```sql
CREATE DATABASE game_db;
CREATE USER game_user WITH PASSWORD 'game_password';
GRANT ALL PRIVILEGES ON DATABASE game_db TO game_user;
\q
```

### ะจะฐะณ 4: ะะฝะธัะธะฐะปะธะทะฐัะธั ััะตะผั ะะ

```bash
psql -U game_user -d game_db -f postgresql/schemas/db_1.sql
```

### ะจะฐะณ 5: ะกะฑะพัะบะฐ ะฟัะพะตะบัะฐ

```bash
# ะกะพะทะดะฐะนัะต ะดะธัะตะบัะพัะธั ะดะปั ัะฑะพัะบะธ
mkdir -p build
cd build

# ะะฐะฟัััะธัะต cmake
cmake ..

# ะกะพะฑะตัะธัะต ะฟัะพะตะบั
make -j$(nproc)
```

### ะจะฐะณ 6: ะะฐัััะพะนะบะฐ ะบะพะฝัะธะณััะฐัะธะธ

ะััะตะดะฐะบัะธััะนัะต `configs/config_vars.yaml`:

```yaml
server-port: 8080
worker-threads: 4
worker-fs-threads: 2
logger-level: info
pg-connection: 'postgresql://game_user:game_password@localhost:5432/game_db'
```

### ะจะฐะณ 7: ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ะดะปั Telegram ะฑะพัะฐ

```bash
cd ..  # ะะตัะฝะธัะตัั ะฒ ะบะพัะตะฝั ะฟัะพะตะบัะฐ
pip3 install -r telegram_bot_requirements.txt
```

### ะจะฐะณ 8: ะะฐัััะพะนะบะฐ Telegram ะฑะพัะฐ

1. ะกะพะทะดะฐะนัะต ะฑะพัะฐ ัะตัะตะท [@BotFather](https://t.me/botfather)
2. ะกะพััะฐะฝะธัะต ัะพะบะตะฝ
3. ะกะพะทะดะฐะนัะต ัะฐะนะป `.env`:

```bash
cat > .env << EOF
TELEGRAM_BOT_TOKEN=your_bot_token_here
API_BASE_URL=http://localhost:8080
EOF
```

## ๐ฎ ะะฐะฟััะบ ะฟัะพะตะบัะฐ

### ะะฐัะธะฐะฝั 1: ะััะฝะพะน ะทะฐะฟััะบ

#### ะขะตัะผะธะฝะฐะป 1: Backend ัะตัะฒะตั

```bash
cd build
./game_userver --config ../configs/static_config.yaml \
               --config_vars ../configs/config_vars.yaml
```

ะั ะดะพะปะถะฝั ัะฒะธะดะตัั:

```
[INFO] Server started on port 8080
[INFO] PostgreSQL connection established
```

#### ะขะตัะผะธะฝะฐะป 2: ะกะพะทะดะฐะฝะธะต ัะตััะพะฒัั ะดะฐะฝะฝัั

```bash
python3 create_test_data.py
```

#### ะขะตัะผะธะฝะฐะป 3: Telegram ะฑะพั

```bash
export TELEGRAM_BOT_TOKEN="your_token"
export API_BASE_URL="http://localhost:8080"
python3 telegram_bot.py
```

### ะะฐัะธะฐะฝั 2: Docker (ะตัะปะธ ะฝะฐัััะพะตะฝ)

```bash
docker-compose up
```

## ๐ ะกะพะทะดะฐะฝะธะต ะบะพะฝัะตะฝัะฐ

### ะงะตัะตะท ัะบัะธะฟั (ัะตะบะพะผะตะฝะดัะตััั)

```bash
python3 create_test_data.py
```

ะญัะพั ัะบัะธะฟั ัะพะทะดะฐัั:
- ะะฐะบ "ะะฑัะธะต ะทะฝะฐะฝะธั" ั 5 ะฒะพะฟัะพัะฐะผะธ
- ะะฟัะธะพะฝะฐะปัะฝะพ: ะฟะฐะบ "ะัะพะณัะฐะผะผะธัะพะฒะฐะฝะธะต" ั 3 ะฒะพะฟัะพัะฐะผะธ

### ะงะตัะตะท API ะฒัััะฝัั

#### 1. ะกะพะทะดะฐัั ะฟะฐะบ

```bash
curl -X POST http://localhost:8080/create-pack \
  -H "Content-Type: application/json" \
  -d '{"title": "ะะพั ะฒะธะบัะพัะธะฝะฐ"}'
```

ะัะฒะตั:
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "title": "ะะพั ะฒะธะบัะพัะธะฝะฐ"
}
```

#### 2. ะกะพะทะดะฐัั ะฒะพะฟัะพั

```bash
curl -X POST http://localhost:8080/create-question \
  -H "Content-Type: application/json" \
  -d '{
    "pack_id": "550e8400-e29b-41d4-a716-446655440000",
    "text": "ะะฐะบะพะน ัะทัะบ ะธัะฟะพะปัะทัะตััั ะฒ backend?",
    "image_url": null
  }'
```

#### 3. ะกะพะทะดะฐัั ะฒะฐัะธะฐะฝัั ะพัะฒะตัะพะฒ

```bash
# ะัะฐะฒะธะปัะฝัะน ะพัะฒะตั
curl -X POST http://localhost:8080/create-variant \
  -H "Content-Type: application/json" \
  -d '{
    "question_id": "question-uuid-here",
    "text": "C++",
    "is_correct": true
  }'

# ะะตะฟัะฐะฒะธะปัะฝัะต ะพัะฒะตัั
curl -X POST http://localhost:8080/create-variant \
  -H "Content-Type: application/json" \
  -d '{
    "question_id": "question-uuid-here",
    "text": "Python",
    "is_correct": false
  }'
```

## ๐ค ะัะฟะพะปัะทะพะฒะฐะฝะธะต Telegram ะฑะพัะฐ

### ะะพะผะฐะฝะดั

- `/start` - ะะฐัะฐัั ัะฐะฑะพัั ั ะฑะพัะพะผ
- `/newgame` - ะกะพะทะดะฐัั ะฝะพะฒัั ะธะณัั
- `/cancel` - ะัะผะตะฝะธัั ัะตะบัััั ะธะณัั
- `/help` - ะะพะบะฐะทะฐัั ัะฟัะฐะฒะบั

### ะัะพัะตัั ะธะณัั

1. **ะะฐะฟัััะธัะต ะฑะพัะฐ**: ะะฐะนะดะธัะต ะฒะฐัะตะณะพ ะฑะพัะฐ ะฒ Telegram ะธ ะฝะฐะถะผะธัะต Start
2. **ะกะพะทะดะฐะนัะต ะธะณัั**: ะัะฟัะฐะฒััะต `/newgame`
3. **ะัะฑะตัะธัะต ะฟะฐะบ**: ะะฐะถะผะธัะต ะฝะฐ ะพะดะธะฝ ะธะท ะฟัะตะดะปะพะถะตะฝะฝัั ะฟะฐะบะพะฒ
4. **ะะฐัะฝะธัะต ะธะณัั**: ะะฐะถะผะธัะต "โถ๏ธ ะะฐัะฐัั ะธะณัั"
5. **ะัะฒะตัะฐะนัะต ะฝะฐ ะฒะพะฟัะพัั**: ะัะฑะธัะฐะนัะต ะฟัะฐะฒะธะปัะฝัะต ะฒะฐัะธะฐะฝัั
6. **ะกะผะพััะธัะต ัะตะทัะปััะฐัั**: ะะพัะปะต ะฟะพัะปะตะดะฝะตะณะพ ะฒะพะฟัะพัะฐ ัะฒะธะดะธัะต ัะฐะฑะปะธัั ะปะธะดะตัะพะฒ

## ๐ API Reference

### Content Management Endpoints

#### GET /get-all-packs
ะะพะปััะธัั ะฒัะต ะฟะฐะบะธ ะฒะพะฟัะพัะพะฒ

**Response:**
```json
[
  {
    "id": "uuid",
    "title": "ะะฐะทะฒะฐะฝะธะต ะฟะฐะบะฐ"
  }
]
```

#### POST /create-pack
ะกะพะทะดะฐัั ะฝะพะฒัะน ะฟะฐะบ

**Request:**
```json
{
  "title": "ะะฐะทะฒะฐะฝะธะต ะฟะฐะบะฐ"
}
```

#### POST /create-question
ะกะพะทะดะฐัั ะฒะพะฟัะพั

**Request:**
```json
{
  "pack_id": "uuid",
  "text": "ะขะตะบัั ะฒะพะฟัะพัะฐ",
  "image_url": "https://example.com/image.jpg" // optional
}
```

#### POST /create-variant
ะกะพะทะดะฐัั ะฒะฐัะธะฐะฝั ะพัะฒะตัะฐ

**Request:**
```json
{
  "question_id": "uuid",
  "text": "ะขะตะบัั ะฒะฐัะธะฐะฝัะฐ",
  "is_correct": true
}
```

### Game API Endpoints

#### POST /game/create-session
ะกะพะทะดะฐัั ะธะณัะพะฒัั ัะตััะธั

**Request:**
```json
{
  "pack_id": "uuid"
}
```

**Response:**
```json
{
  "id": "session-uuid",
  "pack_id": "pack-uuid",
  "state": "waiting",
  "current_question_index": 0
}
```

#### POST /game/add-player
ะะพะฑะฐะฒะธัั ะธะณัะพะบะฐ ะฒ ัะตััะธั

**Request:**
```json
{
  "game_session_id": "uuid",
  "player_name": "ะะผั ะธะณัะพะบะฐ"
}
```

#### POST /game/start
ะะฐัะฐัั ะธะณัั

**Request:**
```json
{
  "game_session_id": "uuid"
}
```

#### GET /game/current-question
ะะพะปััะธัั ัะตะบััะธะน ะฒะพะฟัะพั

**Query params:** `game_session_id=uuid`

**Response:**
```json
{
  "question": {
    "id": "uuid",
    "text": "ะขะตะบัั ะฒะพะฟัะพัะฐ",
    "image_url": "url"
  },
  "variants": [
    {
      "id": "uuid",
      "text": "ะะฐัะธะฐะฝั ะพัะฒะตัะฐ"
    }
  ]
}
```

#### POST /game/submit-answer
ะัะฟัะฐะฒะธัั ะพัะฒะตั

**Request:**
```json
{
  "player_id": "uuid",
  "variant_id": "uuid"
}
```

**Response:**
```json
{
  "result": "correct|incorrect",
  "game_finished": false
}
```

#### GET /game/results
ะะพะปััะธัั ัะตะทัะปััะฐัั ะธะณัั

**Query params:** `game_session_id=uuid`

**Response:**
```json
{
  "game_session": {
    "id": "uuid",
    "state": "finished"
  },
  "players": [
    {
      "id": "uuid",
      "name": "ะะณัะพะบ 1",
      "score": 5
    }
  ]
}
```

## ๐ง Troubleshooting

### Backend ะฝะต ะทะฐะฟััะบะฐะตััั

**ะัะพะฑะปะตะผะฐ:** `Failed to connect to PostgreSQL`

**ะะตัะตะฝะธะต:**
```bash
# ะัะพะฒะตัััะต, ััะพ PostgreSQL ะทะฐะฟััะตะฝ
sudo systemctl status postgresql

# ะัะพะฒะตัััะต ัััะพะบั ะฟะพะดะบะปััะตะฝะธั ะฒ config_vars.yaml
# ะัะพะฒะตัััะต, ััะพ ะฟะพะปัะทะพะฒะฐัะตะปั ะธ ะะ ัััะตััะฒััั
psql -U game_user -d game_db -c "SELECT 1"
```

### Telegram ะฑะพั ะฝะต ะพัะฒะตัะฐะตั

**ะัะพะฑะปะตะผะฐ:** ะะพั ะฝะต ัะตะฐะณะธััะตั ะฝะฐ ะบะพะผะฐะฝะดั

**ะะตัะตะฝะธะต:**
1. ะัะพะฒะตัััะต ัะพะบะตะฝ ะฑะพัะฐ
2. ะฃะฑะตะดะธัะตัั, ััะพ ะฑะพั ะทะฐะฟััะตะฝ (ัะผะพััะธัะต ะปะพะณะธ)
3. ะัะพะฒะตัััะต, ััะพ API_BASE_URL ะฟัะฐะฒะธะปัะฝัะน
4. ะฃะฑะตะดะธัะตัั, ััะพ backend ัะตัะฒะตั ะทะฐะฟััะตะฝ

### ะัะธะฑะบะฐ "ะะต ัะดะฐะปะพัั ะทะฐะณััะทะธัั ัะฟะธัะพะบ ะฟะฐะบะพะฒ"

**ะัะพะฑะปะตะผะฐ:** ะะพั ะฝะต ะผะพะถะตั ะฟะพะปััะธัั ะฟะฐะบะธ

**ะะตัะตะฝะธะต:**
```bash
# ะัะพะฒะตัััะต, ััะพ backend ะทะฐะฟััะตะฝ
curl http://localhost:8080/ping

# ะัะพะฒะตัััะต, ััะพ ะตััั ะฟะฐะบะธ ะฒ ะะ
curl http://localhost:8080/get-all-packs

# ะัะปะธ ะฟะฐะบะพะฒ ะฝะตั, ัะพะทะดะฐะนัะต ะธั
python3 create_test_data.py
```

### ะัะธะฑะบะธ ะบะพะผะฟะธะปััะธะธ

**ะัะพะฑะปะตะผะฐ:** ะัะธะฑะบะธ ะฟัะธ ัะฑะพัะบะต ะฟัะพะตะบัะฐ

**ะะตัะตะฝะธะต:**
```bash
# ะัะธััะธัะต build ะดะธัะตะบัะพัะธั
rm -rf build
mkdir build
cd build

# ะะตัะตัะพะฑะตัะธัะต ั ะฟะพะดัะพะฑะฝัะผ ะฒัะฒะพะดะพะผ
cmake .. -DCMAKE_BUILD_TYPE=Debug
make VERBOSE=1
```

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

- [README.md](README.md) - ะัะฝะพะฒะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ะฟัะพะตะบัะฐ
- [TELEGRAM_BOT_README.md](TELEGRAM_BOT_README.md) - ะะพะดัะพะฑะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ะฟะพ ะฑะพัั
- [configs/static_config.yaml](configs/static_config.yaml) - ะะพะฝัะธะณััะฐัะธั handlers
- [postgresql/schemas/db_1.sql](postgresql/schemas/db_1.sql) - ะกัะตะผะฐ ะฑะฐะทั ะดะฐะฝะฝัั

## ๐ ะะพัะพะฒะพ!

ะขะตะฟะตัั ั ะฒะฐั ะตััั ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐั ัะธััะตะผะฐ ะฒะธะบัะพัะธะฝั!

ะะพะฟัะพะฑัะนัะต:
1. ะะฐะฟัััะธัั backend ัะตัะฒะตั
2. ะกะพะทะดะฐัั ัะตััะพะฒัะต ะดะฐะฝะฝัะต
3. ะะฐะฟัััะธัั Telegram ะฑะพัะฐ
4. ะะฐัะฐัั ะธะณัั ัะตัะตะท `/newgame`

ะฃะดะฐัะธ! ๐