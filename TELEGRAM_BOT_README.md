# Telegram Bot –¥–ª—è –∏–≥—Ä—ã –≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É

–≠—Ç–æ—Ç Telegram –±–æ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–≥—Ä–∞—Ç—å –≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É —á–µ—Ä–µ–∑ HTTP API –≤–∞—à–µ–≥–æ userver –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üéÆ –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π
- üë• –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
- ‚ùì –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤
- üèÜ –ü–æ–¥—Å—á–µ—Ç –æ—á–∫–æ–≤ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- üìä –í—ã–±–æ—Ä —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–∞–∫–æ–≤ –≤–æ–ø—Ä–æ—Å–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r telegram_bot_requirements.txt
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram

1. –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/botfather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
export TELEGRAM_BOT_TOKEN="your_bot_token_here"
export API_BASE_URL="http://localhost:8080"  # URL –≤–∞—à–µ–≥–æ API
```

–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```bash
TELEGRAM_BOT_TOKEN=your_bot_token_here
API_BASE_URL=http://localhost:8080
```

## –ó–∞–ø—É—Å–∫

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python3 telegram_bot.py
```

### –ó–∞–ø—É—Å–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º .env —Ñ–∞–π–ª–∞

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `.env` —Ñ–∞–π–ª, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `python-dotenv`:

```bash
pip install python-dotenv
```

–ò –¥–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ `telegram_bot.py`:

```python
from dotenv import load_dotenv
load_dotenv()
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
- `/newgame` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É
- `/cancel` - –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –∏–≥—Ä—É
- `/help` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É

### –ü—Ä–æ—Ü–µ—Å—Å –∏–≥—Ä—ã

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã**: –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newgame` –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–∫ –≤–æ–ø—Ä–æ—Å–æ–≤
2. **–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤**: –î—Ä—É–≥–∏–µ –∏–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è (–≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ - –æ–¥–∏–Ω –∏–≥—Ä–æ–∫)
3. **–ù–∞—á–∞–ª–æ –∏–≥—Ä—ã**: –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –∏–≥—Ä—É"
4. **–û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã**: –í—ã–±–∏—Ä–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**: –ü–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ —É–≤–∏–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## API Endpoints

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ endpoints –≤–∞—à–µ–≥–æ API:

### Content Management
- `GET /get-all-packs` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–∞–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤
- `POST /create-pack` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞–∫
- `POST /create-question` - –°–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å
- `POST /create-variant` - –°–æ–∑–¥–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞

### Game API
- `POST /game/create-session` - –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä–æ–≤—É—é —Å–µ—Å—Å–∏—é
- `POST /game/add-player` - –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞
- `POST /game/start` - –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
- `GET /game/current-question` - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å
- `POST /game/submit-answer` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç
- `GET /game/results` - –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤

```bash
curl -X POST http://localhost:8080/create-pack \
  -H "Content-Type: application/json" \
  -d '{"title": "–û–±—â–∏–µ –∑–Ω–∞–Ω–∏—è"}'
```

### –°–æ–∑–¥–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞

```bash
curl -X POST http://localhost:8080/create-question \
  -H "Content-Type: application/json" \
  -d '{
    "pack_id": "your-pack-uuid",
    "text": "–ö–∞–∫–∞—è —Å—Ç–æ–ª–∏—Ü–∞ –†–æ—Å—Å–∏–∏?",
    "image_url": null
  }'
```

### –°–æ–∑–¥–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞

```bash
# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
curl -X POST http://localhost:8080/create-variant \
  -H "Content-Type: application/json" \
  -d '{
    "question_id": "your-question-uuid",
    "text": "–ú–æ—Å–∫–≤–∞",
    "is_correct": true
  }'

# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
curl -X POST http://localhost:8080/create-variant \
  -H "Content-Type: application/json" \
  -d '{
    "question_id": "your-question-uuid",
    "text": "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
    "is_correct": false
  }'
```

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–≥—Ä—ã

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –±–æ—Ç–∞ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å:

1. **–•–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–∞–∫ –≤–æ–ø—Ä–æ—Å–æ–≤**
2. **–í–æ–ø—Ä–æ—Å—ã –≤ —ç—Ç–æ–º –ø–∞–∫–µ**
3. **–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞** (–º–∏–Ω–∏–º—É–º 2, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 4)
4. **–•–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞

### –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```python
import requests

API_URL = "http://localhost:8080"

# –°–æ–∑–¥–∞–µ–º –ø–∞–∫
pack_response = requests.post(f"{API_URL}/create-pack", 
    json={"title": "–¢–µ—Å—Ç–æ–≤–∞—è –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞"})
pack_id = pack_response.json()["id"]

# –°–æ–∑–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å
question_response = requests.post(f"{API_URL}/create-question",
    json={
        "pack_id": pack_id,
        "text": "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 2+2?",
        "image_url": None
    })
question_id = question_response.json()["id"]

# –°–æ–∑–¥–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
variants = [
    {"text": "3", "is_correct": False},
    {"text": "4", "is_correct": True},
    {"text": "5", "is_correct": False},
    {"text": "22", "is_correct": False}
]

for variant in variants:
    requests.post(f"{API_URL}/create-variant",
        json={
            "question_id": question_id,
            **variant
        })

print(f"–°–æ–∑–¥–∞–Ω –ø–∞–∫ —Å ID: {pack_id}")
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram   ‚îÇ
‚îÇ    User     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram   ‚îÇ
‚îÇ     Bot     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ HTTP API
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   userver   ‚îÇ
‚îÇ  Game API   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PostgreSQL  ‚îÇ
‚îÇ  Database   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### –û—à–∏–±–∫–∞ "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∞–∫–æ–≤"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ `API_BASE_URL`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å –ø–∞–∫–∏

### –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–≥—Ä—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –ø–∞–∫–µ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–æ–ø—Ä–æ—Å–æ–≤ –µ—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ API —Å–µ—Ä–≤–µ—Ä–∞

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

–ë–æ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `python-telegram-bot` –∏ `ConversationHandler`.
–û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

- `SELECTING_PACK` - –í—ã–±–æ—Ä –ø–∞–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
- `WAITING_FOR_PLAYERS` - –û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤
- `PLAYING` - –ü—Ä–æ—Ü–µ—Å—Å –∏–≥—Ä—ã

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å:
- –ü–æ–¥–¥–µ—Ä–∂–∫—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤ –æ–¥–Ω–æ–º —á–∞—Ç–µ
- –¢–∞–π–º–µ—Ä –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
- –°–∏—Å—Ç–µ–º—É —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–∫–æ–≤
- –†–µ–∂–∏–º —Ç—É—Ä–Ω–∏—Ä–∞

## –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ —É—Å–ª–æ–≤–∏—è –ª–∏—Ü–µ–Ω–∑–∏–∏, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–µ–∫—Ç game_userver.